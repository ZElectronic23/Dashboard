<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Z.Electronic Dashboard</title>
  <link rel="icon" type="image/png" href="https://i.ibb.co/6n0x9G6/user.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root{--gold:#dba935;--light:#f0f0f0;--dark:#222}
    body{margin:0;font-family:'Cairo',sans-serif;background-image:url("https://i.ibb.co/PS9M6NX/BG2-Phone.png" );background-size:cover;background-attachment:fixed;color:var(--light);min-height:100vh;}
    .top-bar{position:fixed;top:0;width:100%;background:rgba(0,0,0,.6);display:flex;justify-content:space-between;align-items:center;padding:10px 20px;z-index:1000;box-sizing:border-box}
    .top-bar-left, .top-bar-right { display: flex; align-items: center; gap: 20px; }
    .datetime-widget { display: flex; align-items: center; gap: 10px; background-color: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px; font-size: 16px; color: var(--light); text-shadow: 0 0 5px var(--gold); }
    .datetime-widget .material-icons { font-size: 20px; color: var(--gold); }
    .lang-switcher { cursor: pointer; font-weight: bold; font-size: 16px; background-color: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px; color: var(--gold); user-select: none; text-shadow: 0 0 5px var(--gold); border: none; }
    .container{margin:90px auto 40px;padding:20px;max-width:900px;background:rgba(0,0,0,.5);border-radius:15px;box-shadow:0 0 20px rgba(0,0,0,.7);}
    h2{color:var(--gold);margin-bottom:10px; font-weight: 700;}
    .profile-section{display:flex;align-items:center;gap:20px;margin-bottom:25px;flex-wrap:wrap}
    .profile-img{width:100px;height:100px;border-radius:50%;border:2px solid var(--gold);object-fit:cover;box-shadow:0 0 10px var(--gold)}
    .profile-data p{margin:4px 0;font-size:18px}
    .cards{display:flex;gap:20px;flex-wrap:wrap; justify-content: center;}
    .card{background:var(--dark);flex:1 1 150px;max-width:150px;border-radius:12px;text-align:center;padding:15px 10px;cursor:pointer;box-shadow:0 0 10px rgba(219,169,53,.7);transition:transform .3s;color:var(--gold);display:none; font-weight: 700;}
    .card.active{display:block}
    html[dir="ltr"] .top-bar { flex-direction: row-reverse; }
    html[dir="ltr"] .profile-section { text-align: left; }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="top-bar-left">
        <button class="lang-switcher" id="lang-switcher" title="Switch Language" type="button">EN</button>
    </div>
    <div class="top-bar-right">
        <div class="datetime-widget">
            <span id="time-icon" class="material-icons"></span>
            <span id="time"></span>
            <span id="date"></span>
        </div>
        <div style="color: var(--light);" data-translate="welcome">مرحباً<span id="userName">...</span></div>
        <button onclick="logout()" style="background:none; border:none; color:var(--gold);font-size:16px; cursor:pointer; font-family: inherit;" data-translate="logout_button">تسجيل خروج</button>
    </div>
  </div>
  <div class="container">
    <div class="profile-section">
      <img id="profileImg" class="profile-img" src="" alt="صورة المستخدم" />
      <div class="profile-data">
        <h2 id="empName"></h2>
        <p><strong data-translate="job_title">المسمى الوظيفي</strong>: <span id="empJob"></span></p>
        <p><strong data-translate="email_title">البريد الإلكتروني</strong>: <span id="empEmail"></span></p>
      </div>
    </div>
    <div class="cards">
      <div id="cardProjects" class="card"><i class="material-icons">folder</i><span data-translate="projects_card">المشاريع</span></div>
      <div id="cardTimeline" class="card"><i class="material-icons">timeline</i><span data-translate="timeline_card">الجدول الزمني</span></div>
      <div id="cardReports" class="card"><i class="material-icons">bar_chart</i><span data-translate="reports_card">التقارير</span></div>
      <div id="cardContracts" class="card"><i class="material-icons">gavel</i><span data-translate="contracts_card">العقود</span></div>
      <div id="cardViolations" class="card"><i class="material-icons">error</i><span data-translate="violations_card">المخالفات</span></div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const translations = {
        ar: { welcome: "مرحباً", logout_button: "تسجيل خروج", job_title: "المسمى الوظيفي", email_title: "البريد الإلكتروني", projects_card: "المشاريع", timeline_card: "الجدول الزمني", reports_card: "التقارير", contracts_card: "العقود", violations_card: "المخالفات" },
        en: { welcome: "Welcome", logout_button: "Logout", job_title: "Job Title", email_title: "Email", projects_card: "Projects", timeline_card: "Timeline", reports_card: "Reports", contracts_card: "Contracts", violations_card: "Violations" }
      };
      let currentLang = localStorage.getItem('lang') || 'ar';

      function setLanguage(lang) {
        currentLang = lang; localStorage.setItem('lang', lang);
        document.documentElement.lang = lang; document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        document.getElementById('lang-switcher').textContent = lang === 'ar' ? 'EN' : 'ع';
        document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); if (translations[lang][key]) el.textContent = translations[lang][key]; });
      }

      function updateClock() {
        const now = new Date(new Date().toLocaleString("en-US", {timeZone: "Africa/Cairo"}));
        let hours = now.getHours();
        document.getElementById('time-icon').textContent = (hours >= 6 && hours < 18) ? 'wb_sunny' : 'nightlight_round';
        const ampm = hours >= 12 ? 'PM' : 'AM'; hours = hours % 12; hours = hours ? hours : 12;
        document.getElementById('time').textContent = `${hours.toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')} ${ampm}`;
        document.getElementById('date').textContent = now.toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : 'en-GB');
      }

      function logout() { localStorage.removeItem('userData'); localStorage.removeItem('lang'); window.location.href = 'index.html'; }
      
      document.getElementById('lang-switcher').addEventListener('click', () => setLanguage(currentLang === 'ar' ? 'en' : 'ar'));
      
      const userDataString = localStorage.getItem('userData');
      if (!userDataString) { logout(); return; }

      try {
        const userData = JSON.parse(userDataString);
        document.getElementById('userName').textContent = `, ${userData.empName}`;
        document.getElementById('empName').textContent = userData.empName;
        document.getElementById('empJob').textContent = userData.empJob;
        document.getElementById('empEmail').textContent = userData.empEmail;
        document.getElementById('profileImg').src = userData.profileImg;
        if (userData.permissions) {
          if (userData.permissions.projects) document.getElementById('cardProjects').classList.add('active');
          if (userData.permissions.timeline) document.getElementById('cardTimeline').classList.add('active');
          if (userData.permissions.reports) document.getElementById('cardReports').classList.add('active');
          if (userData.permissions.contracts) document.getElementById('cardContracts').classList.add('active');
          if (userData.permissions.violations) document.getElementById('cardViolations').classList.add('active');
        }
      } catch (e) { alert("خطأ في قراءة البيانات. سيتم تسجيل الخروج."); logout(); }
      
      // استدعاء الدوال في النهاية بعد تعريف كل شيء
      setLanguage(currentLang);
      updateClock();
      setInterval(updateClock, 1000);
    });
  </script>
</body>
</html>
