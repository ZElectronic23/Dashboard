<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Z.Electronic Dashboard</title>
  <link rel="icon" type="image/x-icon" href="LOGO ICO.png"> 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root{--gold:#dba935;--light:#f0f0f0;--dark:#222; --silver: #c0c0c0;}
    body{margin:0;font-family:'Cairo',sans-serif;background-image:url("https://i.ibb.co/PS9M6NX/BG2-Phone.png" );background-size:cover;background-attachment:fixed;color:var(--light);min-height:100vh; line-height: 1.6;}
    * { box-sizing: border-box; }
    .top-bar{position:fixed;top:0;left:0;right:0;width:100%;background:rgba(0,0,0,.7);display:flex;justify-content:space-between;align-items:center;padding:8px 15px;z-index:1000;}
    .top-bar-left { position: absolute; left: 15px; }
    .top-bar-center { position: absolute; left: 50%; transform: translateX(-50%); }
    .top-bar-right { position: absolute; right: 15px; }
    .datetime-widget { display: flex; align-items: center; gap: 8px; background-color: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 20px; font-size: 14px; color: var(--light); text-shadow: 0 0 5px var(--gold); }
    .datetime-widget .material-icons { font-size: 18px; color: var(--gold); }
    .lang-switcher { cursor: pointer; font-weight: bold; font-size: 14px; background-color: var(--silver); color: black; padding: 5px 10px; border-radius: 20px; user-select: none; border: none; }
    .user-menu { position: relative; }
    .user-menu-button { display: flex; align-items: center; gap: 10px; cursor: pointer; background: rgba(0,0,0,0.5); border: 1px solid var(--gold); border-radius: 25px; padding: 2px 10px 2px 2px; color: var(--light); font-family: inherit; font-size: 16px; }
    .user-menu-button .top-bar-avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
    .user-menu-button .user-name-container { display: flex; flex-direction: column; align-items: flex-start; }
    .user-menu-button .translated-name { font-size: 11px; color: var(--silver); line-height: 1; }
    .dropdown-content { position: absolute; top: 140%; left: 50%; transform: translateX(-50%); background-color: var(--dark); min-width: 220px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5); z-index: 1; border-radius: 8px; border: 1px solid var(--gold); overflow: hidden; pointer-events: none; opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease; transform-origin: top center; }
    .dropdown-content.show { pointer-events: auto; opacity: 1; transform: translateX(-50%) translateY(0); }
    .dropdown-content a { color: var(--light); padding: 12px 16px; text-decoration: none; display: flex; align-items: center; gap: 10px; transition: background-color 0.2s; opacity: 0; transform: translateX(20px); transition: opacity 0.3s ease, transform 0.3s ease; }
    .dropdown-content a:hover { background-color: var(--gold); color: var(--dark); }
    .dropdown-content .material-icons { font-size: 20px; }
    .dashboard-container{margin:80px auto 40px;padding:15px;width:100%;max-width:950px; background:rgba(0,0,0,.5);border-radius:15px;box-shadow:0 0 20px rgba(0,0,0,.7);}
    .profile-section{display:flex;align-items:center;gap:20px;margin-bottom:25px;flex-direction:column; text-align:center;}
    .profile-img{width:120px;height:120px;border-radius:50%;border:2px solid var(--gold);object-fit:cover;box-shadow:0 0 10px var(--gold)}
    .profile-data h2 { margin-top: 0; margin-bottom: 10px; }
    .profile-data p{margin:4px 0;font-size:18px}
    .cards{display:flex;gap:15px;flex-wrap:wrap; justify-content: center;}
    .card{background:var(--dark);flex-basis: 140px; flex-grow: 1; max-width: 200px; border-radius:12px;text-align:center;padding:15px 10px;cursor:pointer;box-shadow:0 0 10px rgba(219,169,53,.7);transition:transform .3s;color:var(--gold);display:none; font-weight: 700;}
    .card.active{display:block}
    .card:hover { transform: scale(1.05); }
    .card .material-icons { font-size: 48px; margin-bottom: 8px; }
    @media (min-width: 600px) {
      .profile-section { flex-direction: row; text-align: inherit; }
      html[dir="ltr"] .profile-section { text-align: left; }
      html[dir="rtl"] .profile-section { text-align: right; }
      .lang-switcher, .datetime-widget { font-size: 16px; padding: 5px 15px; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="top-bar-left">
        <button class="lang-switcher" id="lang-switcher" title="Switch Language" type="button">EN</button>
    </div>
    <div class="top-bar-center">
        <div class="user-menu">
            <button class="user-menu-button" id="user-menu-button">
                <img id="top-bar-avatar" src="" alt="Avatar" class="top-bar-avatar">
                <div class="user-name-container">
                    <span id="user-menu-name"></span>
                    <div id="user-menu-name-en" class="translated-name"></div>
                </div>
            </button>
            <div class="dropdown-content" id="dropdown-content">
                <a href="#"><i class="material-icons">request_quote</i><span data-translate="requests">الطلبات</span></a>
                <a href="#"><i class="material-icons">model_training</i><span data-translate="trainings">التدريبات</span></a>
                <a href="#"><i class="material-icons">leaderboard</i><span data-translate="evaluation">التقييم</span></a>
                <a href="#"><i class="material-icons">work</i><span data-translate="job_tasks">مهام وظيفية</span></a>
                <a href="#"><i class="material-icons">settings</i><span data-translate="settings">الإعدادات</span></a>
                <a href="#" onclick="logout()"><i class="material-icons">logout</i><span data-translate="logout_button">تسجيل الخروج</span></a>
            </div>
        </div>
    </div>
    <div class="top-bar-right">
        <div class="datetime-widget">
            <span id="time-icon" class="material-icons"></span>
            <span id="time"></span>
            <span id="date"></span>
        </div>
    </div>
  </div>
  <div class="dashboard-container">
    <div class="profile-section">
      <img id="profileImg" class="profile-img" src="" alt="صورة المستخدم" />
      <div class="profile-data">
        <h2 id="empName"></h2>
        <p><strong data-translate="job_title">المسمى الوظيفي</strong>: <span id="empJob"></span></p>
        <p><strong data-translate="email_title">البريد الإلكتروني</strong>: <span id="empEmail"></span></p>
      </div>
    </div>
    <div class="cards">
      <div id="cardProjects" class="card"><i class="material-icons">folder</i><span data-translate="projects_card">المشاريع</span></div>
      <div id="cardTimeline" class="card"><i class="material-icons">timeline</i><span data-translate="timeline_card">الجدول الزمني</span></div>
      <div id="cardReports" class="card"><i class="material-icons">bar_chart</i><span data-translate="reports_card">التقارير</span></div>
      <div id="cardContracts" class="card"><i class="material-icons">gavel</i><span data-translate="contracts_card">العقود</span></div>
      <div id="cardViolations" class="card"><i class="material-icons">error</i><span data-translate="violations_card">المخالفات</span></div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const userDataString = localStorage.getItem('userData');
      if (!userDataString) { window.location.href = 'index.html'; return; }
      
      let userData;
      try {
        userData = JSON.parse(userDataString);
      } catch(e) {
        localStorage.removeItem('userData');
        window.location.href = 'index.html';
        return;
      }

      const translations = {
        ar: { logout_button: "تسجيل خروج", job_title: "المسمى الوظيفي", email_title: "البريد الإلكتروني", projects_card: "المشاريع", timeline_card: "الجدول الزمني", reports_card: "التقارير", contracts_card: "العقود", violations_card: "المخالفات", requests: "الطلبات", trainings: "التدريبات", evaluation: "التقييم", job_tasks: "مهام وظيفية", settings: "الإعدادات" },
        en: { logout_button: "Logout", job_title: "Job Title", email_title: "Email", projects_card: "Projects", timeline_card: "Timeline", reports_card: "Reports", contracts_card: "Contracts", violations_card: "Violations", requests: "Requests", trainings: "Trainings", evaluation: "Evaluation", job_tasks: "Job Tasks", settings: "Settings" }
      };
      let currentLang = localStorage.getItem('lang') || 'ar';

      function setLanguage(lang) {
        currentLang = lang; localStorage.setItem('lang', lang);
        document.documentElement.lang = lang; document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        document.getElementById('lang-switcher').textContent = lang === 'ar' ? 'EN' : 'ع';
        document.querySelectorAll('[data-translate]').forEach(el => { const key = el.getAttribute('data-translate'); if (translations[lang][key]) el.textContent = translations[lang][key]; });
      }

      function updateClock() {
        const now = new Date(new Date().toLocaleString("en-US", {timeZone: "Africa/Cairo"}));
        let hours = now.getHours();
        document.getElementById('time-icon').textContent = (hours >= 6 && hours < 18) ? 'wb_sunny' : 'nightlight_round';
        const ampm = hours >= 12 ? 'PM' : 'AM'; hours = hours % 12; hours = hours ? hours : 12;
        document.getElementById('time').textContent = `${hours.toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')} ${ampm}`;
        document.getElementById('date').textContent = now.toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : 'en-GB');
      }

      async function translateArabicToEnglish(text) {
          if (!text || !/[\u0600-\u06FF]/.test(text)) return text;
          try {
              const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text )}&langpair=ar|en`);
              const data = await response.json();
              return data.responseData.translatedText;
          } catch (error) { return text; }
      }

      window.logout = function() { localStorage.removeItem('userData'); localStorage.removeItem('lang'); window.location.href = 'index.html'; }
      
      document.getElementById('lang-switcher').addEventListener('click', () => setLanguage(currentLang === 'ar' ? 'en' : 'ar'));
      
      // Populate user data
      document.getElementById('empName').textContent = userData.empName;
      document.getElementById('empJob').textContent = userData.empJob;
      document.getElementById('empEmail').textContent = userData.empEmail;
      document.getElementById('profileImg').src = userData.profileImg;
      document.getElementById('top-bar-avatar').src = userData.profileImg;
      document.getElementById('user-menu-name').textContent = userData.empName;
      translateArabicToEnglish(userData.empName).then(translatedName => {
          document.getElementById('user-menu-name-en').textContent = translatedName;
      });

      if (userData.permissions) {
        Object.keys(userData.permissions).forEach(key => {
            const cardId = `card${key.charAt(0).toUpperCase() + key.slice(1)}`;
            const card = document.getElementById(cardId);
            if (card && userData.permissions[key]) {
                card.classList.add('active');
            }
        });
      }
      
      setLanguage(currentLang);
      updateClock();
      setInterval(updateClock, 1000);

      // Animation code
      const menuButton = document.getElementById('user-menu-button');
      const dropdown = document.getElementById('dropdown-content');
      const dropdownItems = dropdown.querySelectorAll('a');
      function toggleDropdown(show) {
        if (show) {
          dropdown.classList.add('show');
          let delay = 0;
          dropdownItems.forEach(item => { setTimeout(() => { item.style.opacity = '1'; item.style.transform = 'translateX(0)'; }, delay); delay += 50; });
        } else {
          let delay = 0;
          [...dropdownItems].reverse().forEach(item => { setTimeout(() => { item.style.opacity = '0'; item.style.transform = 'translateX(20px)'; }, delay); delay += 50; });
          setTimeout(() => dropdown.classList.remove('show'), delay + 50);
        }
      }
      menuButton.addEventListener('click', (event) => { event.stopPropagation(); toggleDropdown(!dropdown.classList.contains('show')); });
      window.addEventListener('click', () => { if (dropdown.classList.contains('show')) { toggleDropdown(false); } });
    });
  </script>
</body>
</html>
