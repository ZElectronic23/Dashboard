<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل الدخول</title>
  <link rel="icon" type="image/png" href="https://i.ibb.co/6n0x9G6/user.png">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:'Cairo', sans-serif;background-image:url("https://i.ibb.co/PS9M6NX/BG2-Phone.png" );background-size:cover;background-position:center;height:100vh;display:flex;justify-content:center;align-items:center;color:white;}
    .login-box{background-color:rgba(0,0,0,.75);padding:30px 25px 35px;border-radius:18px;box-shadow:0 0 30px rgba(219,169,53,.8);width:320px;text-align:center;}
    .login-box h2{margin-bottom:25px;color:#dba935;font-weight:700;}
    input[type="text"],input[type="password"]{width:100%;padding:12px 15px;margin:12px 0;border-radius:10px;border:none;font-size:16px;outline:0;font-family:inherit;box-sizing:border-box;color:#fff;background-color:#222;}
    #loginBtn{width:100%;padding:12px;margin-top:20px;background:linear-gradient(135deg,#dba935,#999);border:none;border-radius:10px;font-size:17px;color:#000;cursor:pointer;font-weight:700;}
    .error-msg{color:#ff6666;margin-top:10px;font-size:14px;min-height:20px;text-align:right;}
  </style>
</head>
<body>
  <div class="login-box">
    <h2>تسجيل الدخول</h2>
    <form id="loginForm">
      <input id="username" type="text" placeholder="اسم المستخدم" required autocomplete="username" />
      <input id="password" type="password" placeholder="كلمة المرور" required autocomplete="current-password" />
      <div id="error-msg" class="error-msg"></div>
      <button id="loginBtn" type="submit">دخول</button>
    </form>
  </div>

  <script>
    // إذا كان المستخدم مسجل دخوله بالفعل، انقله مباشرة
    if (localStorage.getItem('userData')) {
      window.location.href = 'dashboard.html';
    }

    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const loginBtn = document.getElementById('loginBtn');
      const errorMsg = document.getElementById('error-msg');
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const API_URL = "https://script.google.com/macros/s/AKfycbxY4jHtUguk_pjowbt7-bbYNoMoBbe5G8qX7rJBA_4oRvWh39dfz4CNgB-se-9sgwVJ/exec"; // تأكد من أنه الرابط الجديد
      
      loginBtn.disabled = true;
      loginBtn.textContent = 'جاري التحقق...';
      errorMsg.textContent = '';

      const urlWithParams = new URL(API_URL );
      urlWithParams.searchParams.append('action', 'login');
      urlWithParams.searchParams.append('username', username);
      urlWithParams.searchParams.append('password', password);

      fetch(urlWithParams)
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // حفظ بيانات المستخدم الكاملة في الذاكرة
          localStorage.setItem('userData', JSON.stringify(data.userData));
          // الانتقال إلى لوحة التحكم
          window.location.href = 'dashboard.html';
        } else {
          errorMsg.textContent = data.message;
          loginBtn.disabled = false;
          loginBtn.textContent = 'دخول';
        }
      })
      .catch(error => {
        errorMsg.textContent = 'فشل الاتصال. تحقق من الرابط وإعدادات النشر.';
        loginBtn.disabled = false;
        loginBtn.textContent = 'دخول';
      });
    });
  </script>
</body>
</html>
